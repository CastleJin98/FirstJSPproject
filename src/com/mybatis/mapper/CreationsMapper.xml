<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 창작물 SQL문 작성 1차 2차 나눠질 예정 -->
<!-- SQL문 작성 , DB이름 추가 -->

<mapper namespace="creations">
	<!-- 창작물 올리기 -->
	<insert id="insert" parameterType="CreationsDTO">
		insert into creations
		(creation_number, creation_title, creation_content, category_code, category_name, creation_writeday, member_number , creation_sumnail)
		values(#{creationNumber}, #{creationTitle}, #{creationContent}, #{creationCode}, #{creationName}, #{creationWriteday}, #{memberNumber} , #{creationSumnail})
	</insert>

	<!-- 메인페이지 창작물 조회하기 -->
	<select id="selectAll" resultType="CreationsVO">
		select creation_title, creation_read_count, category_code, category_name, m.member_nickname, m.member_pfp
		from `member` m join creations c
		on m.member_number = c.member_number 
		order by creation_number desc
		limit 0,9
	</select>
	
	<!-- 카테고리 테마별 창작물 조회하기-->
	<select id="selectMenu" resultType="CreationsVO" parameterType="map">
		select c.creation_number , c.creation_title , c.creation_sumnail , m.member_nickname , m.member_pfp 
		from creations c join `member` m 
		on c.member_number = m.member_number and category_code = #{categoryCode} and category_name = #{categoryName}
		order by creation_number desc
		<!-- limit 0,9 -->
	</select>
	
	<select id="select" parameterType="_int" resultType="CreationsVO">
		select creation_number, creation_title, creation_content, category_code, category_name, creation_writeday, m.member_number, m.member_id
		from `member` m  join creations c
		on creation_number = #{creationNumber} and m.member_number = c.member_number
	</select>
	
	<!-- 창작물 삭제  -->
	<delete id="delete" parameterType="_int">
		delete from creations
		where member_number = #{memberNumber}
	</delete>
	
	<select id="getSequence" resultType="_int">
		select last_insert_id()
	</select>
	
	<!-- 2차 창작물 배경화면 -->
		<select id="category2background" parameterType="CreationsVO" resultType="CreationsVO">
			select creation_title , member_nickname 
			from `member` m  join creations c
			on m.member_number = c.member_number 
			where category_code = '201' and category_name = '배경화면'
		</select>
		
		<update id="update" parameterType="CreationsFileDTO">
			update creations
			set creation_sumnail = #{fileSystemName}
			where creation_number = #{creationNumber}
		</update>
</mapper>





